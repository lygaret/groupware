#!/usr/bin/env ruby

require 'readline'
require 'awesome_print'

require_relative '../config/app'
App::Container.finalize!

# save term state, and restore on Ctrl-C
stty_save = `stty -g`.chomp
trap('INT') { system('stty', stty_save); exit }

db = App::Container['db.connection']
db.synchronize do |conn|
    first = true
    while buf = Readline.readline("> ", true)
        begin
            conn.execute2 buf do |row|
                puts row.join "\t"
            end
        rescue => ex
            puts "error: #{ex.message}"
        end
    end
end