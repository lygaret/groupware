#!/usr/bin/env ruby
# frozen_string_literal: true

require_relative "../config/system"
System::Container.finalize!

require "optparse"

options = {}
OptionParser.new do |opts|
  opts.banner = "Usage: migrate [options]"

  opts.on("-t", "--target INTEGER", Integer, "the target version of the database") do |v|
    options[:target] = v
  end
end.parse!

# because we need specific database setup,
# we can't use the `sequel -m` cli for migrations

connection = System::Container["db.connection"]
migrations = System::Container.root.join "config/migrations"

Sequel.extension :migration
Sequel::Migrator.run(connection, migrations, target: options[:target])
